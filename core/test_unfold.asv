%test_unfold()
%   test unfold and fold function
clear
clc
Qpause = true;
%% test mode_n_unfold()
disp('%%%%%%%%test mode_n_unfold%%%%%%%%');
% example1
%test mode_n_unfold(T)
disp('Exp 1 test mode_n_unfold(T)');
disp('high order matrix input');
T = rand(2,4,6,8);
% disp('T=');
% disp(T)
M = mode_n_unfold(T);
fprintf("Default mode is 1.\n")
fprintf("T(2,3,4,5) is %d, and the corresponding element in the formal order unfolding matrix is %d\n",T(2,3,4,5),M(2,3+(4-1)*4+(5-1)*4*6));

disp('Tensor class input');
T = tensor(rand(2,4,6,8));
% disp('T=');
% disp(T)
M = mode_n_unfold(T);
fprintf("Default mode is 1.\n")
fprintf("T(2,3,4,5) is %d, and the corresponding element in the formal order unfolding matrix is %d\n",T(2,3,4,5),M(2,3+(4-1)*4+(5-1)*4*6));
disp("----------------------------------------------------------------------------------------------");

%example 2
%test mode_n_unfold(T,mode) and mode_n_fold(M,mode,size,order) 
disp('Exp 2 test mode_n_unfold(T,mode)');
disp('high order matrix input');
T = rand(2,4,6,8);
% disp('T=');
% disp(T)
mode = 2;
fprintf('mode=%d\n',mode);
M = mode_n_unfold(T,mode);
fprintf("T(2,2,3,4) is %d, and the corresponding element in the formal order unfolding matrix is %d\n",T(2,2,3,4),M(2,2+(3-1)*2+(4-1)*2*6));
T1 = mode_n_fold(M,mode,size(T));
fprintf("T(2,2,3,4) is %d, and T1(2,2,3,4) is %d\n",T(2,2,3,4),T1(2,2,3,4));

disp('Tensor class input');
T = tensor(rand(2,4,6,8));
% disp('T=');
% disp(T)
mode = 2;
fprintf('mode=%d\n',mode);
M = mode_n_unfold(T,mode);
fprintf("T(2,2,3,4) is %d, and the corresponding element in the formal order unfolding matrix is %d\n",T(2,2,3,4),M(2,3+(4-1)*6+(2-1)*6*8));
T1 = mode_n_fold(M,mode,T.size);
fprintf("T(2,2,3,4) is %d, and T1(2,2,3,4) is %d\n",T(2,2,3,4),T1(2,2,3,4));
disp("----------------------------------------------------------------------------------------------");

%example 3
%test mode_n_unfold(T,mode,order)
disp('Exp 3 test mode_n_unfold(T,mode,order)');
disp('high order matrix input');
T = rand(2,4,6,8);
% disp('T=');
% disp(T)
mode = 2;
fprintf('mode=%d\n',mode);
M = mode_n_unfold(T,mode,'i');
fprintf("T(2,2,3,4) is %d, and the corresponding element in the inverse order unfolding matrix is %d\n",T(2,2,3,4),M(2,3+(4-1)*6+(2-1)*6*8));
T1 = mode_n_fold(M,mode,size(T),'i');
fprintf("T(2,2,3,4) is %d, and T1(2,2,3,4) is %d\n",T(2,2,3,4),T1(2,2,3,4));

disp('Tensor class input');
T = tensor(rand(2,4,6,8));
% disp('T=');
% disp(T)
mode = 2;
fprintf('mode=%d\n',mode);
M = mode_n_unfold(T,2,'i');
fprintf("T(2,2,3,4) is %d, and the corresponding element in the inverse order unfolding matrix is %d\n",T(2,2,3,4),M(2,3+(4-1)*6+(2-1)*6*8));
T1 = mode_n_fold(M,mode,T.size,'i');
fprintf("T(2,2,3,4) is %d, and T1(2,2,3,4) is %d\n",T(2,2,3,4),T1(2,2,3,4));
disp("----------------------------------------------------------------------------------------------");

if Qpause
    fprintf("Enter any key to continue,press ctrl+c to exit\n")
    pause
end
%% test mode_n1n2_unfold()
disp('%%%%%%test mode_n1n2_unfold()%%%%%');

%example 1
%test mode_n1n2_unfold(T)
disp('Exp 1 test mode_n1n2_unfold(T)');
disp('high order matrix input');
T = rand(2,4,6,8,10);
% disp('T=');
% disp(T)
disp("mode=1.")
TU = mode_n1n2_unfold(T);
fprintf("T(2,3,5,7,9) is %d, and the corresponding element unfolding matrix is %d in mode-1 unfolding.\n",T(2,3,5,7,9),TU(2,3+(5-1)*4+(7-1)*4*6+(9-1)*4*6*8));

disp('tensor class input');
T = tensor(rand(2,4,6,8,10));
% disp('T=');
% disp(T)
TU = mode_n1n2_unfold(T);
fprintf("T(2,3,5,7,9) is %d, and the corresponding element unfolding matrix is %d in mode-1 unfolding.\n",T(2,3,5,7,9),TU(2,3+(5-1)*4+(7-1)*4*6+(9-1)*4*6*8));
disp("----------------------------------------------------------------------------------------------");

%example 2
%test mode_n1n2_unfold(T,n)
disp('Exp 2 test mode_n1n2_unfold(T,n)');
disp('high order matrix input');
T = rand(2,4,6,8,10);
% disp('T=');
% disp(T)
n = [4,2];
fprintf("mode = %d,%d",n(1),n(2))
TU = mode_n1n2_unfold(T,n);
fprintf("T(2,3,5,7,9) is %d, and the corresponding element unfolding matrix is %d in mode_%d_%d_unfolding.\n",T(2,3,5,7,9),TU(7,3,2+(5-1)*2+(9-1)*2*6),n(1),n(2));
T1 = mode_n1n2_fold(TU,n,size(T));
fprintf("T(2,3,5,7,9) is %d, and T1(2,3,5,7,9) is %d\n",T(2,3,5,7,9),T1(2,3,5,7,9));

disp('Tensor class input');
T = tensor(rand(2,4,6,8,10));
% disp('T=');
% disp(T)
n = [4,2];
fprintf("mode = %d,%d",n(1),n(2))
TU = mode_n1n2_unfold(T,n);
fprintf("T(2,3,5,7,9) is %d, and the corresponding element unfolding matrix is %d in mode_%d_%d_unfolding.\n",T(2,3,5,7,9),TU(7,3,2+(5-1)*2+(9-1)*2*6),n(1),n(2));
T1 = mode_n1n2_fold(TU,n,T.size);
fprintf("T(2,3,5,7,9) is %d, and T1(2,3,5,7,9) is %d\n",T(2,3,5,7,9),T1(2,3,5,7,9));
disp("----------------------------------------------------------------------------------------------");

%example 3
%test mode_n1n2_unfold(T,n1,n2,...,nn)
disp('Exp 3 test mode_n1n2_unfold(T,n1,n2,...,nn)');
disp('high order matrix input');
T = rand(2,4,6,8,10);
% disp('T=');
% disp(T)
n1 = 4;
n2 = 2;
TU = mode_n1n2_unfold(T,n1,n2);
fprintf("T(2,3,5,7,9) is %d, and the corresponding element unfolding matrix is %d in mode_%d_%d_unfolding.\n",T(2,3,5,7,9),TU(7,3,2+(5-1)*2+(9-1)*2*6),n(1),n(2));
T1 = mode_n1n2_fold(TU,n(1),n(2),size(T));
fprintf("T(2,3,5,7,9) is %d, and T1(2,3,5,7,9) is %d\n",T(2,3,5,7,9),T1(2,3,5,7,9));

disp('Tensor class input');
T = tensor(rand(2,4,6,8,10));
% disp('T=');
% disp(T)
n1 = 4;
n2 = 2;
TU = mode_n1n2_unfold(T,n1,n2);
fprintf("T(2,3,5,7,9) is %d, and the corresponding element unfolding matrix is %d in mode_%d_%d_unfolding.\n",T(2,3,5,7,9),TU(7,3,2+(5-1)*2+(9-1)*2*6),n(1),n(2));
T1 = mode_n1n2_fold(TU,n(1),n(2),T.size);
fprintf("T(2,3,5,7,9) is %d, and T1(2,3,5,7,9) is %d\n",T(2,3,5,7,9),T1(2,3,5,7,9));
disp("----------------------------------------------------------------------------------------------");

if Qpause
    fprintf("Enter any key to continue,press ctrl+c to exit\n")
    pause
end
%% test k_unfold()
disp('%%%%%%test k_unfold()%%%%%');
%example 1
%test mode_n1n2_unfold(T)
disp('Exp 1 test k_unfold(T)');
disp('high order matrix input');
T = rand(3,4,6,8,10);
% disp('T=');
% disp(T)
fprintf("default modeK = 1.\n");
M = k_unfold(T);
fprintf("T(2,3,5,7,9) is %d, and the corresponding element unfolding matrix is %d in %d_unfolding.\n",T(2,3,5,7,9),M(2,3+(5-1)*4+(7-1)*4*6+(9-1)*4*6*8),1);

disp('Tensor class input');
T = tensor(rand(3,4,6,8,10));
% disp('T=');
% disp(T)
fprintf("default modeK = 1.\n");
M = k_unfold(T);
fprintf("T(2,3,5,7,9) is %d, and the corresponding element unfolding matrix is %d in %d_unfolding.\n",T(2,3,5,7,9),M(2,3+(5-1)*4+(7-1)*4*6+(9-1)*4*6*8),1);
disp("----------------------------------------------------------------------------------------------");

%example 2
%test mode_n1n2_unfold(T,k)
disp('Exp 2 test k_unfold(T,k)');
disp('high order matrix input');
T = rand(3,4,6,8,10);
% disp('T=');
% disp(T)
modeK = 2;
fprintf("modeK = %d.\n",modeK);
M = k_unfold(T,modeK);
fprintf("T(2,3,5,7,9) is %d, and the corresponding element unfolding matrix is %d in %d_unfolding.\n",T(2,3,5,7,9),M(2+(3-1)*3,5+(7-1)*6+(9-1)*6*8),modeK);
T1 = k_fold(M,size(T));
fprintf("T(2,3,5,7,9) is %d, and T1(2,3,5,7,9) is %d\n",T(2,3,5,7,9),T1(2,3,5,7,9));

disp('Tensor class input');
T = tensor(rand(3,4,6,8,10));
% disp('T=');
% disp(T)
modeK = 2;
fprintf("modeK = %d.\n",modeK);
M = k_unfold(T,modeK);
fprintf("T(2,3,5,7,9) is %d, and the corresponding element unfolding matrix is %d in %d_unfolding.\n",T(2,3,5,7,9),M(2+(3-1)*3,5+(7-1)*6+(9-1)*6*8),modeK);
T1 = k_fold(M,T.size);
fprintf("T(2,3,5,7,9) is %d, and T1(2,3,5,7,9) is %d\n",T(2,3,5,7,9),T1(2,3,5,7,9));
disp("----------------------------------------------------------------------------------------------");

if Qpause
    fprintf("Enter any key to continue,press ctrl+c to exit\n")
    pause
end
%% test Lshift_n_unfold()
disp('%%%%%%test Lshift_n_unfold()%%%%%');
%example
%test M = Lshift_n_unfold(T,l,n) 
disp('Exp test Lshift_n_unfold(T)');
disp('high order matrix input');
T = rand(3,4,6,8,10);
% disp('T=');
% disp(T)
l = 3;
n = 2;
fprintf("l = %d, n = %d.\n",l,n);
M = Lshift_n_unfold(T,l,n);
fprintf("T(2,3,5,7,9) is %d, and the corresponding element unfolding matrix is %d in %dshift_%d_unfolding.\n",T(2,3,5,7,9),M(5+(7-1)*6,9+(2-1)*10+(3-1)*10*3),l,n);
T1 = Lshift_n_fold(M,l,size(T));
fprintf("T(2,3,5,7,9) is %d, and T1(2,3,5,7,9) is %d\n",T(2,3,5,7,9),T1(2,3,5,7,9));

disp('Tensor class input');
T = tensor(rand(3,4,6,8,10));
% disp('T=');
% disp(T)
l = 3;
n = 2;
fprintf("l = %d, n = %d.\n",l,n);
M = Lshift_n_unfold(T,l,n);
fprintf("T(2,3,5,7,9) is %d, and the corresponding element unfolding matrix is %d in %dshift_%d_unfolding.\n",T(2,3,5,7,9),M(5+(7-1)*6,9+(2-1)*10+(3-1)*10*3),l,n);
T1 = Lshift_n_fold(M,l,T.size);
fprintf("T(2,3,5,7,9) is %d, and T1(2,3,5,7,9) is %d\n",T(2,3,5,7,9),T1(2,3,5,7,9));
disp("----------------------------------------------------------------------------------------------");

if Qpause
    fprintf("Enter any key to continue,press ctrl+c to exit\n")
    pause
end
%% test balanced_unfold()
disp('%%%%%%test balanced_unfold()%%%%%');
%example
%test M = balanced_unfold(T) 
disp('Exp test Lshift_n_unfold(T)');
disp('high order matrix input');
T = rand(80,8,6,10,6);
% disp('T=');
% disp(T)
[M,l,n] = balanced_unfold(T);
fprintf("lbest = %d, nbest = %d.\n",l,n);
T1 = balanced_fold(M,l,T.size);
fprintf("T(2,3,5,7,6) is %d, and T1(2,3,5,7,6) is %d\n",T(2,3,5,7,6),T1(2,3,5,7,6));

disp('Tensor class input');
T = tensor(rand(80,8,6,10,6));
% disp('T=');
% disp(T)
[M,l,n] = balanced_unfold(T);
fprintf("lbest = %d, nbest = %d.\n",l,n);
T1 = balanced_fold(M,l,T.size);
fprintf("T(2,3,5,7,6) is %d, and T1(2,3,5,7,6) is %d\n",T(2,3,5,7,6),T1(2,3,5,7,6));
disp("----------------------------------------------------------------------------------------------");

if Qpause
    fprintf("Enter any key to continue,press ctrl+c to exit\n")
    pause
end